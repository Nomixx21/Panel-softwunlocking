<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Softunlocking - Panel Completo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { 
  font-family: Arial, sans-serif; 
  background: linear-gradient(135deg, #000428 0%, #004e92 50%, #007acc 100%); 
  color: white; 
  margin: 0; 
  padding: 20px; 
  min-height: 100vh;
}
.container { 
  max-width: 1400px; 
  margin: 0 auto; 
  background: rgba(0,0,0,0.4); 
  border-radius: 20px; 
  padding: 30px; 
  backdrop-filter: blur(10px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
}
.header { 
  text-align: center; 
  margin-bottom: 40px; 
  padding-bottom: 30px;
  border-bottom: 2px solid rgba(0,224,255,0.3);
}
.header h1 { 
  color: #00e0ff; 
  font-size: 3em; 
  margin: 0 0 10px 0;
  text-shadow: 0 0 20px rgba(0,224,255,0.5);
}
.header p { font-size: 1.4em; margin: 0; opacity: 0.9; }
.btn-main { 
  background: linear-gradient(135deg, #ff2d2d, #cc2424); 
  color: white; 
  padding: 15px 30px; 
  border: none; 
  border-radius: 30px; 
  font-size: 1.1em; 
  font-weight: bold;
  cursor: pointer; 
  margin: 10px 5px; 
  text-decoration: none; 
  display: inline-block; 
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(255,45,45,0.4);
}
.btn-main:hover { 
  transform: translateY(-3px); 
  box-shadow: 0 8px 25px rgba(255,45,45,0.6);
}
.btn-secondary { 
  background: linear-gradient(135deg, #00e0ff, #0099cc); 
  color: #000; 
  box-shadow: 0 5px 15px rgba(0,224,255,0.4);
}
.btn-success { 
  background: linear-gradient(135deg, #25D366, #20b858); 
  color: white;
}
.section { 
  background: rgba(255,255,255,0.08); 
  padding: 30px; 
  border-radius: 20px; 
  margin-bottom: 30px; 
  border: 1px solid rgba(0,224,255,0.2);
}
.section h2 { 
  color: #00e0ff; 
  font-size: 1.8em; 
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 15px;
}
.form-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
  gap: 20px; 
  margin-bottom: 25px; 
}
input, select, textarea { 
  width: 100%; 
  padding: 15px; 
  border-radius: 12px; 
  border: 2px solid rgba(0,224,255,0.3); 
  background: rgba(255,255,255,0.95); 
  color: #333; 
  font-size: 1.1em; 
  transition: all 0.3s ease;
  box-sizing: border-box;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #00e0ff;
  box-shadow: 0 0 15px rgba(0,224,255,0.3);
  transform: translateY(-2px);
}
label { 
  display: block; 
  margin-bottom: 8px; 
  font-weight: bold; 
  color: #00e0ff; 
  font-size: 1em;
}
.calculadora { 
  background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,224,255,0.1)); 
  padding: 25px; 
  border-radius: 15px; 
  margin: 20px 0;
  border: 1px solid rgba(0,224,255,0.5);
}
.resultado { 
  font-size: 2em; 
  font-weight: bold; 
  padding: 20px; 
  border-radius: 12px; 
  margin: 15px 0; 
  text-align: center;
}
.ganancia-verde { background: rgba(74,222,128,0.9); color: #000; }
.ganancia-roja { background: rgba(248,113,113,0.9); color: #000; }
.ganancia-amarilla { background: rgba(251,191,36,0.9); color: #000; }
.lista-items { 
  max-height: 350px; 
  overflow-y: auto; 
  background: rgba(0,0,0,0.3); 
  border-radius: 12px; 
  padding: 15px;
}
.item-lista { 
  background: rgba(255,255,255,0.1); 
  padding: 20px; 
  margin-bottom: 15px; 
  border-radius: 12px; 
  border-left: 4px solid #00e0ff;
}
.tabla-trabajos { 
  width: 100%; 
  border-collapse: collapse; 
  margin-top: 20px; 
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  overflow: hidden;
  font-size: 0.9em;
}

.tabla-trabajos th { 
  background: linear-gradient(135deg, rgba(0,224,255,0.3), rgba(0,153,204,0.3)); 
  padding: 12px 10px; 
  text-align: center; 
  font-weight: bold;
  white-space: nowrap;
}

.tabla-trabajos td { 
  padding: 10px 8px; 
  border-bottom: 1px solid rgba(255,255,255,0.1); 
  text-align: center;
  white-space: nowrap;
}

.tabla-trabajos tr:hover {
  background: rgba(0,224,255,0.08);
  transition: 0.2s;
}
.tabla-trabajos button {
  padding: 5px 8px;
  font-size: 0.8em;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: 0.2s;
}

.tabla-trabajos button:hover {
  transform: scale(1.1);
}

.tabla-trabajos select {
  padding: 4px 6px;
  font-size: 0.8em;
  border-radius: 6px;
}

.total-row { 
  background: linear-gradient(135deg, rgba(0,224,255,0.4), rgba(74,222,128,0.4)) !important; 
  font-size: 1.3em; 
  font-weight: bold !important;
}
.whatsapp-btn { 
  background: linear-gradient(135deg, #25D366, #128C7E) !important; 
  box-shadow: 0 5px 15px rgba(37,211,102,0.4) !important;
}
.stats { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
  gap: 20px; 
  margin: 20px 0;
}
.stat-card { 
  background: linear-gradient(135deg, rgba(0,224,255,0.2), rgba(255,45,45,0.2)); 
  padding: 25px; 
  border-radius: 15px; 
  text-align: center;
  border: 1px solid rgba(0,224,255,0.3);
}
.stat-number { font-size: 2.5em; font-weight: bold; color: #00e0ff; margin-bottom: 5px; }
@media (max-width: 768px) { 
  .container { padding: 20px; margin: 10px; }
  .form-grid { grid-template-columns: 1fr; }
  body { padding: 10px; }
}

@media (max-width: 768px) {

  .tabla-trabajos {
    font-size: 0.75em;
  }

  .tabla-trabajos th:nth-child(4),
  .tabla-trabajos td:nth-child(4),
  .tabla-trabajos th:nth-child(9),
  .tabla-trabajos td:nth-child(9) {
    display: none; /* Oculta Problema y Fecha en celular */
  }

  .tabla-trabajos button {
    padding: 3px 5px;
    font-size: 0.7em;
  }

  .section {
    padding: 15px;
  }

  .btn-main {
    width: 100%;
    margin: 8px 0;
  }

}

</style>
</head>
<body>
<div class="container">
<!-- Header -->
<div class="header">
<h1>üõ†Ô∏è Softunlocking</h1>
<p><strong>Panel de Gesti√≥n Completo</strong> | Cali, Valle del Cauca</p>
<a href="https://wa.me/573143861121?text=Hola%20Softunlocking%2C%20reviso%20mis%20trabajos" class="btn-main whatsapp-btn" target="_blank">
üì± WhatsApp Directo
</a>
<button class="btn-main btn-secondary" onclick="exportarDatos()">üì§ Exportar Datos</button>
<button class="btn-main btn-secondary" onclick="limpiarTodo()">üóëÔ∏è Limpiar Todo</button>
</div>

<!-- Estad√≠sticas --> 
<div class="stats">

  <div class="stat-card">
    <div class="stat-number" id="total-clientes">0</div>
    <strong>Total Clientes</strong>
  </div>

  <div class="stat-card">
    <div class="stat-number" id="total-trabajos">0</div>
    <strong>Total Trabajos</strong>
  </div>

  <div class="stat-card">
    <div class="stat-number" id="total-ganancias">$0</div>
    <strong>Ganancias Totales</strong>
  </div>

</div>

<!-- Crear Cliente -->
<div class="section">
<h2>üë§ <span style="font-size:0.7em;">+</span> Nuevo Cliente</h2>
<div class="form-grid">
<div>
<label>Nombre Completo</label>
<input id="cliente-nombre" placeholder="Juan P√©rez">
</div>
<div>
<label>Tel√©fono/WhatsApp</label>
<input id="cliente-telefono" placeholder="314 386 1121">
</div>
<div>
<label>Email (opcional)</label>
<input id="cliente-email" placeholder="juan@email.com">
</div>
</div>
<button class="btn-main" onclick="agregarCliente()">üíæ Guardar Cliente</button>
<div id="lista-clientes" class="lista-items" style="max-height: 200px;"></div>
</div>

<!-- Crear Trabajo -->
<div class="section">
<h2>üîß <span style="font-size:0.7em;">+</span> Nuevo Trabajo</h2>
<div class="form-grid">
<div>
<label>Cliente</label>
<select id="trabajo-cliente">
<option value="">Seleccionar cliente...</option>
</select>
</div>
<div>
<label>Dispositivo</label>
<input id="trabajo-dispositivo" placeholder="Samsung A32, iPhone 12...">
</div>
<div>
<label>Problema</label>
<input id="trabajo-problema" placeholder="Pantalla rota, no carga...">
</div>
<div>
<label>Valor Reparaci√≥n ($)</label>
<input id="trabajo-valor-reparacion" type="number" placeholder="150000" oninput="calcularGanancia()">
</div>
<div>
<label>Repuesto ($)</label>
<input id="trabajo-repuesto" type="number" placeholder="50000" oninput="calcularGanancia()">
</div>
<div>
<label>Domicilio ($)</label>
<input id="trabajo-domicilio" type="number" placeholder="15000" oninput="calcularGanancia()">
</div>
</div><div>
<label>Vendedor</label>
<input id="trabajo-vendedor" placeholder="Nombre vendedor (ej: Juan / Pedro)">
</div>

<div class="calculadora">
<h3>üí∞ Calculadora Autom√°tica (25% Ganancia)</h3>
<div id="resultado-ganancia" class="resultado">Ingresa valores para calcular</div>
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 1.2em; text-align: center;">
<div>Valor Rep: $<span id="total-reparacion">0</span></div>
<div>Costos: $<span id="total-costos">0</span></div>
<div>Ganancia: $<span id="ganancia-final">0</span></div>
</div>
</div>

<button class="btn-main btn-success" onclick="agregarTrabajo()">üöÄ Crear Trabajo</button>
</div>

<!-- Tabla Resumen -->
<div class="section">
<h2>üìä Todos los Trabajos</h2>
<input type="text" id="buscador"
placeholder="üîç Buscar cliente o dispositivo..."
oninput="filtrarTabla()"
style="margin-bottom:15px; padding:10px; border-radius:10px; width:100%;">

<table id="tabla-trabajos" class="tabla-trabajos">
<thead>
<tr>
<th>Cliente</th><th>Tel√©fono</th><th>Dispositivo</th><th>Problema</th>
<th>Valor Rep.</th><th>Costos</th><th>Vendedor</th><th>Ganancia</th><th>Fecha/Hora</th><th>Estado</th><th>Acciones</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
let clientes = JSON.parse(localStorage.getItem('clientesSoftunlocking')) || [];
let trabajos = JSON.parse(localStorage.getItem('trabajosSoftunlocking')) || [];

function actualizarTodo() {
  actualizarListaClientes();
  actualizarTabla();
  actualizarStats();
}

function actualizarListaClientes() {
  const lista = document.getElementById('lista-clientes');
  const select = document.getElementById('trabajo-cliente');
  lista.innerHTML = '';
  select.innerHTML = '<option value="">Seleccionar cliente...</option>';
  
  clientes.forEach((cliente, index) => {
    const div = document.createElement('div');
    div.className = 'item-lista';
    div.innerHTML = `
      <strong>${cliente.nombre}</strong><br>
      üì± ${cliente.telefono} 
      ${cliente.email ? `<br>‚úâÔ∏è ${cliente.email}` : ''}
    `;
    lista.appendChild(div);
    
    const option = document.createElement('option');
    option.value = index;
    option.textContent = cliente.nombre;
    select.appendChild(option);
  });
}

function agregarCliente() {
  const nombre = document.getElementById('cliente-nombre').value.trim();
  const telefono = document.getElementById('cliente-telefono').value.trim();
  const email = document.getElementById('cliente-email').value.trim();
  
  if (nombre && telefono) {
    clientes.push({nombre, telefono, email, fecha: new Date().toLocaleDateString('es-CO')});
    localStorage.setItem('clientesSoftunlocking', JSON.stringify(clientes));
    actualizarTodo();
    document.getElementById('cliente-nombre').value = '';
    document.getElementById('cliente-telefono').value = '';
    document.getElementById('cliente-email').value = '';
    alert('‚úÖ Cliente agregado correctamente!');
  } else {
    alert('‚ùå Nombre y tel√©fono son obligatorios');
  }
}

function calcularGanancia() {
    const reparacion = parseFloat(document.getElementById('trabajo-valor-reparacion').value) || 0;
  const repuesto = parseFloat(document.getElementById('trabajo-repuesto').value) || 0;
  const domicilio = parseFloat(document.getElementById('trabajo-domicilio').value) || 0;
  
  const despuesRepuesto = reparacion - repuesto;
  const despuesDomicilio = despuesRepuesto - domicilio;
  const gananciaNeta = despuesDomicilio * 0.25;
  
  document.getElementById('total-reparacion').textContent = reparacion.toLocaleString('es-CO');
  document.getElementById('total-costos').textContent = (repuesto + domicilio).toLocaleString('es-CO');
  document.getElementById('ganancia-final').textContent = gananciaNeta.toLocaleString('es-CO');
  
  const resultado = document.getElementById('resultado-ganancia');
  if (gananciaNeta > 0) {
    resultado.textContent = `‚úÖ Ganancia: $${gananciaNeta.toLocaleString('es-CO')}`;
    resultado.className = 'resultado ganancia-verde';
  } else if (reparacion > 0) {
    resultado.textContent = `‚ö†Ô∏è Sin ganancia: $${gananciaNeta.toLocaleString('es-CO')}`;
    resultado.className = 'resultado ganancia-roja';
  } else {
    resultado.textContent = 'Ingresa valores';
    resultado.className = 'resultado';
  }
}
function agregarTrabajo() {
  const clienteIdx = document.getElementById('trabajo-cliente').value;
  const dispositivo = document.getElementById('trabajo-dispositivo').value.trim();
  const problema = document.getElementById('trabajo-problema').value.trim();
  const reparacion = parseFloat(document.getElementById('trabajo-valor-reparacion').value) || 0;
  const repuesto = parseFloat(document.getElementById('trabajo-repuesto').value) || 0;
  const domicilio = parseFloat(document.getElementById('trabajo-domicilio').value) || 0;
  const vendedor = document.getElementById('trabajo-vendedor').value.trim();

  if (clienteIdx !== '' && dispositivo && reparacion > 0) {

    const cliente = clientes[clienteIdx];
    const totalCostos = repuesto + domicilio;
    const ganancia = (reparacion - totalCostos) * 0.25;

    const ahora = new Date();

    trabajos.push({
      cliente: cliente.nombre,
      telefono: cliente.telefono,
      dispositivo,
      problema,
      reparacion,
      repuesto,
      domicilio,
      vendedor, // ‚úÖ AHORA S√ç SE GUARDA
      ganancia,
      fecha: ahora.toLocaleString('es-CO'),
      isoFecha: ahora.toISOString(),
      estado: 'En Reparacion'
    });

    localStorage.setItem('trabajosSoftunlocking', JSON.stringify(trabajos));

    actualizarTodo();

    alert(`‚úÖ Trabajo creado!
Cliente: ${cliente.nombre}
Ganancia: $${ganancia.toLocaleString('es-CO')}`);

    // Limpiar formulario
    document.getElementById('trabajo-dispositivo').value = '';
    document.getElementById('trabajo-problema').value = '';
    document.getElementById('trabajo-valor-reparacion').value = '';
    document.getElementById('trabajo-repuesto').value = '';
    document.getElementById('trabajo-domicilio').value = '';
    document.getElementById('trabajo-vendedor').value = ''; // ‚úÖ limpieza a√±adida
    document.getElementById('trabajo-cliente').value = '';

    calcularGanancia();

  } else {
    alert('‚ùå Completa: cliente, dispositivo y valor reparaci√≥n');
  }
}


function actualizarTabla() {
  const tbody = document.querySelector('#tabla-trabajos tbody');
  tbody.innerHTML = '';

  let totalGanancia = 0;

  trabajos.sort((a, b) => new Date(b.isoFecha) - new Date(a.isoFecha));

  trabajos.forEach((trabajo, index) => {

    const row = document.createElement('tr');
    const gananciaClass = trabajo.ganancia > 0 ? 'ganancia-verde' : 'ganancia-roja';

    row.innerHTML = `
      <td><strong>${trabajo.cliente}</strong></td>
      <td>${trabajo.telefono}</td>
      <td>${trabajo.dispositivo}</td>
      <td>${trabajo.problema}</td>
      <td>$${trabajo.reparacion.toLocaleString('es-CO')}</td>
      <td>$${(trabajo.repuesto + trabajo.domicilio).toLocaleString('es-CO')}</td>
      <td>${trabajo.vendedor || 'N/A'}</td>
      <td class="${gananciaClass}">$${trabajo.ganancia.toLocaleString('es-CO')}</td>
      <td>${trabajo.fecha}</td>

      <td>
        <select onchange="cambiarEstado(${index}, this.value)">
          <option value="En reparaci√≥n" ${trabajo.estado === 'En reparaci√≥n' ? 'selected' : ''}>üü° En reparaci√≥n</option>
          <option value="Por entregar" ${trabajo.estado === 'Por entregar' ? 'selected' : ''}>üîµ Por entregar</option>
          <option value="Entregado" ${trabajo.estado === 'Entregado' ? 'selected' : ''}>üü¢ Entregado</option>
        </select>
      </td>

      <td>
        <button onclick="editarTrabajo(${index})">‚úèÔ∏è</button>
        <button onclick="eliminarTrabajo(${index})">üóëÔ∏è</button>
      </td>
    `;

    tbody.appendChild(row);
    totalGanancia += trabajo.ganancia;
  });

  const totalRow = document.createElement('tr');
  totalRow.className = 'total-row';
  totalRow.innerHTML = `
    <td colspan="8"><strong>TOTAL GANANCIAS</strong></td>
    <td>$${totalGanancia.toLocaleString('es-CO')}</td>
    <td colspan="2">${trabajos.length} trabajos</td>
  `;
  tbody.appendChild(totalRow);
}


function actualizarStats() {
  document.getElementById('total-clientes').textContent = clientes.length;
  document.getElementById('total-trabajos').textContent = trabajos.length;
  const totalGanancias = trabajos.reduce((sum, t) => sum + t.ganancia, 0);
  document.getElementById('total-ganancias').textContent = `$${totalGanancias.toLocaleString('es-CO')}`;
}

function exportarDatos() {
  const datos = {
    clientes: clientes,
    trabajos: trabajos,
    fechaExportacion: new Date().toLocaleString('es-CO'),
    totalGanancias: trabajos.reduce((sum, t) => sum + t.ganancia, 0)
  };
  const blob = new Blob([JSON.stringify(datos, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `softunlocking-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
}

function limpiarTodo() {
  if (confirm('¬øSeguro? Perder√°s todos los datos de clientes y trabajos.')) {
    localStorage.removeItem('clientesSoftunlocking');
    localStorage.removeItem('trabajosSoftunlocking');
    clientes = [];
    trabajos = [];
    actualizarTodo();
    alert('‚úÖ Datos eliminados');
  }
}

function eliminarTrabajo(index) {
  if (confirm('¬øSeguro que deseas eliminar este trabajo?')) {
    trabajos.splice(index, 1);
    localStorage.setItem('trabajosSoftunlocking', JSON.stringify(trabajos));
    actualizarTodo();
  }
}

function editarTrabajo(index) {

  const trabajo = trabajos[index];

  const nuevaReparacion = parseFloat(prompt("Nuevo valor reparaci√≥n:", trabajo.reparacion)) || trabajo.reparacion;
  const nuevoRepuesto = parseFloat(prompt("Nuevo valor repuesto:", trabajo.repuesto)) || trabajo.repuesto;
  const nuevoDomicilio = parseFloat(prompt("Nuevo valor domicilio:", trabajo.domicilio)) || trabajo.domicilio;
  const nuevoVendedor = prompt("Vendedor:", trabajo.vendedor) || trabajo.vendedor;

  const totalCostos = nuevoRepuesto + nuevoDomicilio;
  const nuevaGanancia = (nuevaReparacion - totalCostos) * 0.25;

  trabajos[index] = {
    ...trabajo,
    reparacion: nuevaReparacion,
    repuesto: nuevoRepuesto,
    domicilio: nuevoDomicilio,
    vendedor: nuevoVendedor,
    ganancia: nuevaGanancia
  };

  localStorage.setItem('trabajosSoftunlocking', JSON.stringify(trabajos));

  actualizarTodo();

  alert('‚úÖ Trabajo actualizado correctamente');
}

function cambiarEstado(index, nuevoEstado) {
  trabajos[index].estado = nuevoEstado;
  localStorage.setItem('trabajosSoftunlocking', JSON.stringify(trabajos));
  actualizarTabla();

}

function filtrarTabla() {
  const texto = document.getElementById('buscador').value.toLowerCase();
  const filas = document.querySelectorAll('#tabla-trabajos tbody tr');

  filas.forEach(fila => {
    if (fila.textContent.toLowerCase().includes(texto)) {
      fila.style.display = '';
    } else {
      fila.style.display = 'none';
    }
  });
}
// Inicializar
actualizarTodo();
</script>
</body>
</html>
